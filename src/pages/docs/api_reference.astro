---
import DocsLayout from "../../layouts/DocsLayout.astro";
import CodeBlock from "../../components/CodeBlock.astro";

const headings = [
    { depth: 2, slug: "component-class", text: "Component Class" },
    { depth: 3, slug: "constructor", text: "Constructor" },
    { depth: 3, slug: "properties", text: "Properties" },
    { depth: 3, slug: "methods", text: "Methods" },
    {
        depth: 2,
        slug: "tailwindintegration-class",
        text: "TailwindIntegration Class",
    },
    {
        depth: 2,
        slug: "bootstrapintegration-class",
        text: "BootstrapIntegration Class",
    },
    { depth: 2, slug: "cli-commands", text: "CLI Commands" },
    { depth: 2, slug: "lifecycle-hooks", text: "Lifecycle Hooks" },
    { depth: 2, slug: "error-handling", text: "Error Handling" },
];
---

<DocsLayout title="API Reference" headings={headings}>
    <h1>API Reference</h1>

    <p>This document provides detailed information about the Snakeskin API.</p>

    <h2 id="component-class">Component Class</h2>

    <p>
        The <code>Component</code> class is the core building block of Snakeskin applications.
    </p>

    <h3 id="constructor">Constructor</h3>

    <CodeBlock code="Component(**props)" language="python" />

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>
            <code>props</code>: A dictionary of properties passed to the
            component
        </li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`from snakeskin.framework import Component

# Create a component with props
my_component = Component(title="Hello", subtitle="World")`}
        language="python"
    />

    <h3 id="properties">Properties</h3>

    <div class="overflow-x-auto my-4">
        <table class="w-full text-left text-sm">
            <thead class="bg-white/5 border-b border-white/10 text-neutral-200">
                <tr>
                    <th class="px-4 py-2">Property</th>
                    <th class="px-4 py-2">Type</th>
                    <th class="px-4 py-2">Description</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-white/5 text-neutral-400">
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >props</td
                    ><td class="px-4 py-2 font-mono">dict</td><td
                        class="px-4 py-2">Properties passed to the component</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >state</td
                    ><td class="px-4 py-2 font-mono">dict</td><td
                        class="px-4 py-2">Internal state of the component</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >_observers</td
                    ><td class="px-4 py-2 font-mono">list</td><td
                        class="px-4 py-2">List of observer callbacks</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >_mounted</td
                    ><td class="px-4 py-2 font-mono">bool</td><td
                        class="px-4 py-2">Whether the component is mounted</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >_lifecycle_hooks</td
                    ><td class="px-4 py-2 font-mono">dict</td><td
                        class="px-4 py-2"
                        >Dictionary of lifecycle hook callbacks</td
                    ></tr
                >
            </tbody>
        </table>
    </div>

    <h3 id="methods">Methods</h3>

    <h4 id="set_state"><code>set_state(new_state: dict) -> str</code></h4>

    <p>Updates the component's state and triggers a re-render.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li><code>new_state</code>: A dictionary of state values to update</li>
    </ul>

    <p><strong>Returns:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>The rendered HTML as a string</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock code='component.set_state({"count": 42})' language="python" />

    <h4 id="mount"><code>mount() -> str</code></h4>

    <p>Mounts the component and triggers the 'mounted' lifecycle hook.</p>

    <p><strong>Returns:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>The rendered HTML as a string</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock code="html = component.mount()" language="python" />

    <h4 id="unmount"><code>unmount() -> None</code></h4>

    <p>
        Unmounts the component and triggers the 'before_unmount' lifecycle hook.
    </p>

    <p><strong>Example:</strong></p>
    <CodeBlock code="component.unmount()" language="python" />

    <h4 id="observe"><code>observe(callback: callable) -> int</code></h4>

    <p>Adds an observer callback that will be called when the state changes.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>
            <code>callback</code>: A function that takes the state as a
            parameter
        </li>
    </ul>

    <p><strong>Returns:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>An observer ID that can be used to remove the observer</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`def log_state(state):
    print(f"State changed: {state}")

observer_id = component.observe(log_state)`}
        language="python"
    />

    <h4 id="unobserve"><code>unobserve(observer_id: int) -> None</code></h4>

    <p>Removes an observer callback.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>
            <code>observer_id</code>: The ID returned by the <code>observe</code
            > method
        </li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock code="component.unobserve(observer_id)" language="python" />

    <h4 id="on"><code>on(event: str, callback: callable) -> None</code></h4>

    <p>Registers a callback for a lifecycle event.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>
            <code>event</code>: The name of the event ('before_mount',
            'mounted', 'before_update', 'updated', 'before_unmount')
        </li>
        <li>
            <code>callback</code>: A function that takes the component as a
            parameter
        </li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`def on_mounted(component):
    print("Component mounted")

component.on('mounted', on_mounted)`}
        language="python"
    />

    <h4 id="render"><code>render() -> str</code></h4>

    <p>
        Renders the component to HTML. This method must be implemented by
        subclasses.
    </p>

    <p><strong>Returns:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>The rendered HTML as a string</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`class MyComponent(Component):
    def render(self):
        return "<div>Hello, World!</div>"`}
        language="python"
    />

    <h2 id="tailwindintegration-class">TailwindIntegration Class</h2>

    <p>
        The <code>TailwindIntegration</code> class provides helpers for Tailwind CSS
        integration.
    </p>

    <h3 id="static-methods">Static Methods</h3>

    <h4 id="setup"><code>setup(project_path: str) -> None</code></h4>

    <p>Sets up Tailwind CSS in a project.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li><code>project_path</code>: The path to the project directory</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`from snakeskin import TailwindIntegration

TailwindIntegration.setup("./my-project")`}
        language="python"
    />

    <h4 id="build">
        <code
            >build(output_path: str = "./dist/tailwind.css", minify: bool =
            True) -> None</code>
    </h4>

    <p>Builds Tailwind CSS.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>
            <code>output_path</code>: The path where the CSS file will be
            written
        </li>
        <li><code>minify</code>: Whether to minify the CSS</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code='TailwindIntegration.build("./dist/styles.css", minify=True)'
        language="python"
    />

    <h2 id="bootstrapintegration-class">BootstrapIntegration Class</h2>

    <p>
        The <code>BootstrapIntegration</code> class provides helpers for Bootstrap
        integration.
    </p>

    <h3 id="static-methods-1">Static Methods</h3>

    <h4 id="setup-1"><code>setup(project_path: str) -> None</code></h4>

    <p>Sets up Bootstrap in a project.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li><code>project_path</code>: The path to the project directory</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`from snakeskin import BootstrapIntegration

BootstrapIntegration.setup("./my-project")`}
        language="python"
    />

    <h4 id="get_cdn_links"><code>get_cdn_links() -> dict</code></h4>

    <p>Gets Bootstrap CDN links for CSS and JS.</p>

    <p><strong>Returns:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>A dictionary with 'css' and 'js' keys containing the HTML tags</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`links = BootstrapIntegration.get_cdn_links()
css_link = links['css']
js_script = links['js']`}
        language="python"
    />

    <h4 id="include_in_template">
        <code
            >include_in_template(template: str, position: str = "head") -> str</code>
    </h4>

    <p>Includes Bootstrap in an HTML template.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li><code>template</code>: The HTML template</li>
        <li>
            <code>position</code>: Where to include Bootstrap ('head', 'body',
            or 'both')
        </li>
    </ul>

    <p><strong>Returns:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li>The modified HTML template</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`html = """
<!DOCTYPE html>
<html>
<head>
    <title>My App</title>
</head>
<body>
    <div id="app"></div>
</body>
</html>
"""

bootstrap_html = BootstrapIntegration.include_in_template(html, "both")`}
        language="python"
    />

    <h2 id="cli-commands">CLI Commands</h2>

    <p>Snakeskin provides several CLI commands for project management.</p>

    <h3 id="snakeskin-create-project-name">
        <code>snakeskin create &lt;project-name&gt;</code>
    </h3>

    <p>Creates a new Snakeskin project.</p>

    <p><strong>Parameters:</strong></p>
    <ul class="list-disc pl-6 space-y-2 text-neutral-300">
        <li><code>project-name</code>: The name of the project to create</li>
    </ul>

    <p><strong>Example:</strong></p>
    <CodeBlock code="snakeskin create my-project" language="bash" />

    <h3 id="snakeskin-dev"><code>snakeskin dev</code></h3>

    <p>Starts the development server with hot reload.</p>

    <p><strong>Example:</strong></p>
    <CodeBlock code="snakeskin dev" language="bash" />

    <h3 id="snakeskin-build"><code>snakeskin build</code></h3>

    <p>Builds the project for production.</p>

    <p><strong>Example:</strong></p>
    <CodeBlock code="snakeskin build" language="bash" />

    <h2 id="lifecycle-hooks">Lifecycle Hooks</h2>

    <p>Snakeskin components have several lifecycle hooks:</p>

    <div class="overflow-x-auto my-4">
        <table class="w-full text-left text-sm">
            <thead class="bg-white/5 border-b border-white/10 text-neutral-200">
                <tr>
                    <th class="px-4 py-2">Hook</th>
                    <th class="px-4 py-2">Description</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-white/5 text-neutral-400">
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >before_mount</td
                    ><td class="px-4 py-2"
                        >Called before the component is mounted</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >mounted</td
                    ><td class="px-4 py-2"
                        >Called after the component is mounted</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >before_update</td
                    ><td class="px-4 py-2"
                        >Called before the component's state is updated</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >updated</td
                    ><td class="px-4 py-2"
                        >Called after the component's state is updated</td
                    ></tr
                >
                <tr
                    ><td class="px-4 py-2 font-mono text-accent-primary"
                        >before_unmount</td
                    ><td class="px-4 py-2"
                        >Called before the component is unmounted</td
                    ></tr
                >
            </tbody>
        </table>
    </div>

    <p><strong>Example:</strong></p>
    <CodeBlock
        code={`from snakeskin.framework import Component

class LifecycleComponent(Component):
    def __init__(self, **props):
        super().__init__(**props)
        
        # Register lifecycle hooks
        self.on('before_mount', self.on_before_mount)
        self.on('mounted', self.on_mounted)
        self.on('before_update', self.on_before_update)
        self.on('updated', self.on_updated)
        self.on('before_unmount', self.on_before_unmount)
    
    def on_before_mount(self, component):
        print("Before mount")
    
    def on_mounted(self, component):
        print("Mounted")
    
    def on_before_update(self, component):
        print("Before update")
    
    def on_updated(self, component):
        print("Updated")
    
    def on_before_unmount(self, component):
        print("Before unmount")
    
    def render(self):
        return "<div>Lifecycle Component</div>"`}
        language="python"
    />

    <h2 id="error-handling">Error Handling</h2>

    <p>Snakeskin provides several ways to handle errors:</p>

    <h3 id="component-error-handling">Component Error Handling</h3>

    <CodeBlock
        code={`from snakeskin.framework import Component

class ErrorHandlingComponent(Component):
    def __init__(self, **props):
        super().__init__(**props)
        self.state = {"error": None, "data": None}
    
    def fetch_data(self):
        try:
            # Simulate API call
            data = {"name": "Example"}
            self.set_state({"data": data, "error": None})
        except Exception as e:
            self.set_state({"error": str(e), "data": None})
    
    def render(self):
        if self.state.get("error"):
            return f"""
            <div class="error">
                <h2>Error</h2>
                <p>{self.state["error"]}</p>
            </div>
            """
        elif self.state.get("data"):
            return f"""
            <div class="data">
                <h2>Data</h2>
                <p>{self.state["data"]["name"]}</p>
            </div>
            """
        else:
            return """
            <div class="loading">
                <p>Loading...</p>
            </div>
            """`}
        language="python"
    />

    <h3 id="global-error-handling">Global Error Handling</h3>

    <p>You can implement a global error handler for your application:</p>

    <CodeBlock
        code={`# error_handler.py
class ErrorHandler:
    def __init__(self):
        self.errors = []
        self.error_callbacks = []
    
    def capture_error(self, error, component=None):
        error_info = {
            "error": error,
            "component": component.__class__.__name__ if component else None,
            "timestamp": time.time()
        }
        self.errors.append(error_info)
        self._notify_callbacks(error_info)
        
        # Log the error
        print(f"Error in {error_info['component']}: {error}")
    
    def add_callback(self, callback):
        self.error_callbacks.append(callback)
    
    def _notify_callbacks(self, error_info):
        for callback in self.error_callbacks:
            callback(error_info)

# Create a singleton instance
error_handler = ErrorHandler()`}
        language="python"
    />

    <CodeBlock
        code={`# In your component
from error_handler import error_handler

class ComponentWithErrorHandling(Component):
    def risky_operation(self):
        try:
            # Some risky operation
            result = 1 / 0  # Will raise ZeroDivisionError
            return result
        except Exception as e:
            error_handler.capture_error(e, self)
            return None`}
        language="python"
    />

    <h2 id="troubleshooting">Troubleshooting</h2>

    <p>
        For common issues and their solutions, see the <a
            href="/docs/troubleshooting"
            class="text-accent-primary hover:underline">Troubleshooting Guide</a
        >.
    </p>
</DocsLayout>
